# 更新日志

简体中文 · [英文](CHANGELOG.md)

本文件记录 Antigravity Cockpit 扩展的所有重要变更。

格式参考 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)。

---

## [2.1.3] - 2026-01-28

### 优化
- **用户体验**: 优化了 Cockpit Tools 未连接时的提示信息。添加了“启动管理器”和“下载”按钮，以便更快捷地解决连接问题。

## [2.1.2]

### 新增
- **账号总览集成**：将原独立的账号总览页面整合进主 HUD 界面，提供更无缝的切换体验与更快的响应速度。
- **国际化适配**：为全新的账号总览界面补齐了全部 18+ 种语言的翻译支持。

### 调整
- **体验优化**：历史记录页签现在会自动选中当前活跃账号，并在下拉列表中以对勾 (✅) 标记。
- **架构重构**：重构了 `AccountsRefreshService` 以实现更稳健的账号状态追踪与更可靠的定期刷新。
- **性能优化**：合并了 Webview 相关的脚本与资源，降低了内存占用并提升了界面响应性能。

### 修复
- **配额历史**：修复了配额恢复至 100% 时，若重置时间未大幅变动导致 'RESET' 标签未显示的问题。

## [2.1.1]

### 新增
- **配额历史清空**：新增清空配额历史记录的功能。
  - 支持清空指定账号或所有账号的全局历史。
  - 增加二次确认弹窗，防止误操作。
- **多语言支持**：全面对齐并补全全部 16 种支持语言的翻译键。
  - 为俄语、越南语、捷克语、波兰语、意大利语和阿拉伯语补充了缺失的历史看板标签与明细表。
  - 对土耳其语进行了专项补全，包含授权登录与账号管理的核心流程。
  - 优化繁体中文的用词一致性。

### 调整
- **UI/UX**：优化仪表盘历史详情表格布局，对齐表头翻译与本地化时间格式。
- **维护**：统一国际化键名命名规范（如全局统一为 `history.range*d` 格式）。

### 修复
- **国际化**：修复俄语和波兰语文件中由于重复编辑导致的翻译冲突块。
- **国际化**：修复繁体中文部分标签中的简繁混杂问题。

## [2.1.0]

### 新增
- **配额历史**：新增历史页签用于追踪配额变化。
  - 账号/模型筛选与 24小时/7天/30天范围。
  - 折线图 + 明细分页表（剩余百分比、变化、重置时间、倒计时）。
  - 本地保存历史快照，100% 首次倒计时下降标记 START。
  - 停留在历史页时自动刷新。

### 调整
- **本地账户导入**：sql.js 切换为 wasm 版本，构建时拷贝 wasm 资源。
- **打包**：打包时排除 `out/sql-asm.js` 与 `out/view/webview/chart.js`。
- **模型定义**：推荐模型常量统一为共享模块供前后端复用。


## [2.0.3]

### 新增
- **账号总览**: 工具栏新增排序方向切换（升序/降序）按钮，方便用户更灵活地管理账号列表。

### 改进
- **分组重命名**：实现了分组重命名的乐观更新（Optimistic UI）。界面现在会在保存时立即更新，无需等待后端确认，提供即时反馈。

### 修复
- **账号总览**: 修复了导入 Refresh Token 时可能出现的类型错误（增加了邮箱非空检查）。

## [2.0.2]

### 修复
- **自动唤醒**: 修复多账号配额重置检测逻辑。系统现在会独立检查所有已选账号的配额状态,而不仅仅是活跃账号。

### 新增
- **自动发布流程**: 配置 GitHub Actions 工作流,当推送版本标签时自动发布到 Open VSX Registry。
- **一键发布脚本**: 新增一键发布脚本,自动化版本号更新、编译、打包、标签创建和推送流程。

## [2.0.1]

### 改进
- **视图记忆**：插件现在会记住您最后停留的视图（仪表盘或账号总览），再次打开时自动恢复，不再强制返回仪表盘。
- **用户体验**：账号管理弹窗新增操作提示，明确“点击邮箱切换视图”与“点击切换登录”的功能区别。
- **国际化**：补充了新增提示文案的多语言翻译。

## [2.0.0]

### 新增
- **Cockpit Tools 双向交互**：实现与 Antigravity Cockpit Tools 的深度集成。
  - **快速切号**：支持从插件端直接触发联动账号切换。
  - **导入流程**：支持实时进度与可取消的批量导入。
  - **手动导入**：支持从 JSON 文件或粘贴内容导入，并提供校验与预览提示。
- **账号树视图**：新增侧边栏账号管理入口。
  - 三层层级展示：账号 → 配额分组 → 模型明细。
  - 明确标识当前账号与设备指纹绑定状态。
- **账号总览页面**：新增独立账号总览视图，统一管理全部账号与配额状态。
  - 支持搜索/筛选/排序、列表/卡片切换、批量选择/删除、导出与刷新全部。
  - 提供设置/公告入口与自动刷新选项。
- **多渠道导入**：支持从插件同步、本地数据库、Antigravity Tools 迁移，以及 refresh_token/JSON 批量导入。
- **离线配置同步**：通过共享文件与 Cockpit Tools 双向同步设置（语言、主题），支持离线更新与启动时合并。
- **配额本地缓存**：实现基于文件的配额缓存机制，提升加载速度并支持离线查看。
- **仪表盘**：账号列表新增“切换登录”动作并提供二次确认。

### 调整
- **UI/UX**：优化仪表盘账号列表布局以适配新增动作。
- **入口**：仪表盘新增“账号总览”快捷入口，统一管理账户与导入流程。
- **稳定性**：增强了配额刷新时的账号切换处理，增加自动重试机制防止数据错乱。
- **分组逻辑**：智能分组对齐桌面端默认模型分组。
- **国际化**：补齐新增视图与对话框的翻译。

## [1.8.40]

### 新增
- **国际化**：新增阿拉伯语支持 (🇸🇦 العربية) - 感谢 [@mohammad-albarham](https://github.com/mohammad-albarham)！([#69](https://github.com/jlcodes99/vscode-antigravity-cockpit/pull/69))
- **国际化**：新增越南语支持 (🇻🇳 Tiếng Việt) - 感谢 [@tienoho](https://github.com/tienoho)！([#73](https://github.com/jlcodes99/vscode-antigravity-cockpit/pull/73))

### 修复
- **国际化**：修复 footer 中硬编码的 "⭐ Star" 文本，改为使用 i18n 系统 - 感谢 [@mohammad-albarham](https://github.com/mohammad-albarham)！([#69](https://github.com/jlcodes99/vscode-antigravity-cockpit/pull/69))

## [1.8.39]

### 修复
- **时序问题**：修复多个账户操作（删除、切换、导入等）并发执行导致状态不一致的问题。
  - 新增账户操作互斥锁机制，确保账户操作串行执行
  - 修复启动时账户同步与用户操作的竞态条件
  - 修复删除账户后刷新配额时账户被自动重新导入的问题（新增自动导入黑名单机制）
- **账户切换**：修复自动切换逻辑仍在检测 Antigravity Tools 账户的问题。

### 调整
- **账户切换**：账户切换逻辑现在**完全跟随本地 Antigravity 客户端**（`state.vscdb`），不再检测 Antigravity Tools。
  - 启动时自动同步本地客户端当前登录账户（静默导入并切换）
  - "切换至当前登录账户"按钮仅检测本地客户端
- **Antigravity Tools 同步**：自动同步功能现在**仅导入账户，不再自动切换**。
- **界面**：移除"账号同步配置"弹窗中的"自动切换账户"复选框及相关说明。

## [1.8.38]

### 修复
- **UI 一致性**：修复仪表盘（Dashboard）中因调用未定义函数导致的配额来源切换时 UI 卡死的问题。
- **离线同步**：修复扩展在离线状态下未向前端同步正确配额来源，导致界面状态显示错误的问题。

### 调整
- **账户切换**：重构账号切换检测逻辑。现在会优先检测本地 Antigravity 客户端（`state.vscdb`）的活跃账号，其次才是 Antigravity Tools，并具备更健壮的回退机制。
- **账户切换**：在所有模式下切换账号后，都会立即触发配额刷新。
- **账户切换**：优化“切换至当前登录账户”逻辑，支持从多个本地源交叉检测账号。

### 工程化
- **代码质量**：为所有 Webview JavaScript 文件启用 ESLint 检查。修复了数十处“定义但从未使用的变量”警告及潜在的运行期错误。
- **构建流程**：将 ESLint 检查集成到构建流程中；现在 `npm run compile` 在构建前会自动进行代码质量校验。

### 国际化
- **文案优化**：更新了全部 15 种语言的 `alreadySynced` 文案（如“已经当前登录账户，无需切换”），以更准确地描述现在支持多源账号检测的情况。

## [1.8.37]

### 调整
- **模型管理**：模型管理器与配额页面现仅显示推荐模型，自动过滤非推荐模型（如 `chat_*`、`Gemini 2.5 Flash` 等）。
- **界面精简**：移除模型管理器工具栏中的"推荐模型"按钮，该按钮已无存在必要。
- **公告**：公告弹窗内容过长时支持滚动查看。

## [1.8.36]

### 修复
- **Windows 本地账户导入**：修复 Windows 系统下导入本地账户时出现 `spawn sqlite3 ENOENT` 错误的问题。使用纯 JavaScript 的 `sql.js` 库替代系统级 `sqlite3` 命令行工具，实现跨平台兼容。
- **账户切换**：修复在"管理账户"弹框中手动切换账户后，配额刷新时被自动切换回原账户的问题。

### 新增
- **切换至当前登录账户**：授权账户行新增"切换至当前登录账户"按钮。点击可快速同步到 Antigravity Tools 或本地客户端当前登录的账户，已存在账户直接切换，不存在则弹出导入确认弹框。

## [1.8.35]

### 调整
- **模型管理**：统一本地模式与授权模式的模型管理逻辑，确保不同配额来源下的操作体验完全一致。
- **模型管理**：本地模式新增模型自动排序（按推荐权重），并支持默认预选推荐模型。
- **界面**：模型管理器中的“推荐模型”按钮现在始终保持可见且可用。

## [1.8.34]

### 调整
- **本地配额**：优化本地配额获取逻辑，优先使用本地账户凭证（从 `state.vscdb` 读取）调用远端 API，本地进程 API 作为兜底。提升数据准确性的同时保持兼容性。
- **自动导入**：本地账户凭证首次使用时自动导入到凭证存储，实现 local 和 authorized 模式的无缝切换。
- **界面**：默认隐藏"计划"按钮并收起计划详情区域。

### 新增
- **本地账户显示**：本地模式下使用远端 API 时，显示当前账户邮箱。

## [1.8.33]

### 新增
- **本地授权导入**：从 `state.vscdb` 读取 Antigravity 客户端 Token，支持本地账号预览与覆盖导入。
- **账号同步配置**：新增功能说明区、自动同步/自动切换开关，以及本地/Antigravity Tools 账号手动导入入口。

### 调整
- **自动同步流程**：自动同步由后端驱动，支持“仅导入不切换”的模式；自动切换后刷新配额。
- **界面**：同步配置弹框结构与文案优化，按钮布局更紧凑。

### 修复
- **授权配额**：避免账号快速移除/切换导致的配额显示竞态（清理缓存并丢弃过期结果）。
- **Windows 端口检测**：改用 PowerShell `Get-NetTCPConnection`，避免本地化 `LISTENING` 解析失败。

## [1.8.32]

### 调整
- **授权组件**：仪表盘与自动唤醒统一复用共享授权账号条组件。
- **自动唤醒**：授权账号条拆为独立卡片，布局与配额页保持一致。
- **构建**：增加共享授权组件脚本的打包输出。

## [1.8.31]

### 新增
- **Antigravity Tools 同步**：支持从 Antigravity Tools 一键导入账号并自动刷新 Token；提供"导入并切换"和"仅导入"两种模式。
- **Manager 同步界面**：仪表盘新增 Antigravity Tools 账号同步区域，支持下拉菜单选择导入模式。
- **自动唤醒**：新增 `maxOutputTokens` 配置项，可自定义唤醒请求的输出 Token 上限。

### 调整
- **账号管理**：优化账号移除逻辑；当所有已选账号被移除时，自动唤醒计划自动关闭。
- **自动唤醒**：改进账号候选逻辑，严格遵守已配置的账号列表，不再自动回退到活跃账号。
- **自动唤醒历史**：优化触发历史展示，结果按模型分组并高亮显示。
- **OAuth 服务**：优化导入账号的 Token 刷新流程，增强错误处理。
- **国际化**：为 Manager 同步、导入模式、OAuth 通知等功能补充全部 14 种语言翻译。
- **QuickPick**：重置时间显示改为跟随系统本地化格式。
- **状态栏**：重置倒计时增加本地重置时间显示。

### 修复
- **计划配置**：修复因账号移除导致已选账号变化时，计划状态未正确持久化的问题。

---

## [1.8.2]

### 新增
- **自动唤醒**：为“配额重置自动唤醒”模式新增时段策略；支持自定义活跃时间段（工作时间）进行实时重置触发，非活跃时段自动切换为固定时间点触发。
- **自动唤醒**：状态卡片现在会显示已选的自动唤醒账号，多账号时支持缩略显示并在悬浮提示中查看完整列表。
- **国际化**：完成了全部 14 种语言关于时段设置与账号标签的翻译更新。

## [1.8.1]

### 调整
- **自动唤醒**：流式请求会完整收集 SSE 分片并记录 usage/traceId；缺失的生成 token 视为 0，唤醒输出上限改为 8 个 token。
- **手动测试**：测试模型选择支持多选（默认选中不变），每个模型并发触发。
- **网络**：新增流式请求辅助并带重试/退避，自动唤醒使用该流程获取响应。

## [1.8.0]

### 新增
- **自动唤醒**：支持多账号选择，定时/自动唤醒与手动测试可指定账号列表。
- **账号管理**：新增账号管理弹框，支持重新授权、移除与状态标识。

### 调整
- **授权卡片**：统一为单行布局，新增下拉入口与点击区域打开账号管理。
- **触发历史**：记录中展示账号徽标，便于区分来源。

## [1.7.24]

### 修复
- **语言**：切换 VS Code 语言后，自动跟随模式会刷新仪表盘/QuickPick。
- **语言**：设置面板可正确显示已保存的语言选项，不再一直显示“自动”。

## [1.7.23]

### 新增
- **公告**：公告图片加入骨架屏与加载失败提示。

### 优化
- **公告**：弹窗公告按公告 ID 去重，只弹一次。
- **面板**：配额刷新时同步公告状态，面板打开后能及时收到公告弹窗。

### 移除
- **调试**：移除仅开发模式的“重置扩展状态”命令。

## [1.7.22]

### 新增
- **授权配额**：授权模式下现在支持模型能力字段（`supportsImages`、`isRecommended`、`tagTitle`、`supportedMimeTypes`），与本地模式一致。

### 优化
- **Webview 管理**：实现 WebviewPanelSerializer，插件重载后能正确恢复 webview 面板引用，避免"孤儿"面板并确保始终使用最新代码。

## [1.7.21]

### 修复
- **公告系统**：公告语言过滤现在会尊重手动语言设置。

## [1.7.2]

### 新增
- **手动语言设置**：在仪表盘设置中新增语言选择器，支持手动覆盖 VS Code 默认语言。

## [1.7.1]

### 调整
- **授权配额**：优先使用 Cloud Code 正式域名，失败时回退到 sandbox；并通过 loadCodeAssist + onboardUser 回退获取 project ID。
- **自动唤醒**：请求域名与授权配额统一为“正式优先 + sandbox 回退”策略。
- **日志**：Cloud Code 请求日志增加完整 URL，便于定位来源。
- **稳定性**：授权配额请求加入重试/退避，遇到短暂失败时复用最近一次成功数据。
- **授权状态**：细化 token 刷新失败/invalid_grant 的日志提示。
- **Cloud Code 客户端**：授权配额与自动唤醒统一请求逻辑与重试策略。
- **错误处理**：403 视为不可重试，避免无意义轮询。
- **配置持久化**：将 `quotaSource` 配置迁移至全局状态，解决 VS Code 设置同步冲突和写入失败问题。旧配置将自动迁移并清理。

### 修复
- **加载状态**：修复首次安装或切换配额来源时，加载界面可能无限卡死的问题。

## [1.7.0]

### 新增
- **授权配额源**：无需本地进程即可监控配额，共用自动唤醒的授权凭证。新增配额来源切换 UI 与授权状态卡片。
- **模型可见性**：支持管理模型显示范围，避免默认列表过于杂乱。
- **调试命令**：开发模式下新增"重置扩展状态"命令，可清除所有状态数据模拟首次安装。

### 调整
- **自动唤醒**：并发触发并汇总结果，触发条件更稳定（满额上升沿 + 冷却 + resetTime 校验）。
- **刷新**：手动刷新冷却缩短为 10 秒。

### 修复
- **自动唤醒**：修复定时触发多时间点 bug，现在不同分钟数的时间（如 `07:00`, `09:30`）都能正确触发。
- **自动唤醒**：修复每周模式多时间点 bug，支持不同分钟数的多个时间点。
- **自动唤醒**：修复状态页面模式显示只显示第一个时间点的问题，现在显示所有时间点。
- **授权监控**：移除未授权时的冗余提示文字。

### 迁移
- **原因**：模型/分组的排序、置顶、自定义名称等更像界面状态，放在 settings.json 会膨胀文件并造成多设备同步噪音。
- **处理**：这些配置迁移至 globalState（不再跨设备同步），并自动清理旧配置项；同时移除列表视图与 `viewMode` 配置。

## [1.6.15]

### 新增
- **自动唤醒**：新增“配额重置自动唤醒”模式，触发历史展示具体触发方式。
- **自动唤醒**：支持自定义唤醒词（触发与测试均可用）。

### 优化
- **自动唤醒**：配置面板按唤醒方式重组，按模式显示对应配置与预览。
- **通知**：启用配额分组时，阈值通知按分组只提示一次。
- **状态栏**：从状态栏打开 Webview 默认回到配额监控页。

## [1.6.14]

### 新增
- **公告**：增强公告系统，支持显示图片（如二维码等）以及基于语言的内容精准投放。
- **公告**：添加 announcement.popup.clickToPreview 功能，点击公告图片可全屏预览。

## [1.6.13]

### 优化
- **自动唤醒**：新增自定义时间输入，并统一每日/每周预设时间
- **自动唤醒**：提升 Crontab 解析准确性并优化超长延迟调度

## [1.6.12]

### 优化
- **自动唤醒**：触发历史新增“手动/自动”标签，方便区分触发方式

## [1.6.11]

### 优化
- **公告**：优化公告列表和弹窗的交互体验

## [1.6.1]

### 修复
- **国际化**：优化翻译文件，修复部分文案问题

## [1.6.0]

### 新增
- **自动唤醒**：全新功能，支持定时向 AI 模型发送请求
  - 设置定时唤醒，提前触发配额重置周期
  - 支持每天、每周、间隔和高级 Crontab 调度模式
  - 多模型选择：自由选择要触发的模型
  - 触发历史记录，显示请求和响应内容（保留 7 天，最多 40 条）
  - 下次触发时间显示在主配额悬浮提示中
  - 使用 VS Code 内置的 Secret Storage API 安全存储授权凭证
  - 通过 Google OAuth 进行 API 授权
- **公告系统**：全新的远程公告通知系统
  - 支持动态推送新特性、重要通知和版本更新说明
  - 支持弹窗提醒、标记已读和通知中心历史查看

## [1.5.48]

### 修复
- **国际化**：修复部分文本未走翻译文件的问题

## [1.5.47]

### 修复
- **列表视图一致性**：更新列表视图以使用与卡片视图相同的“分组管理”逻辑，确保所有视图下的分组管理体验一致。

## [1.5.46]

### 新增
- **自定义分组**：新增「分组管理」弹框，支持手动管理分组
  - 创建、重命名、删除自定义分组
  - 支持多选添加/移除模型
  - 兼容的模型优先排序，不兼容的动态禁用
  - 「自动分组」按钮根据配额预填分组（使用投票机制保留现有分组名称）
  - 配额校验：只有配额和重置时间相同的模型才能归入同一分组
  - 配额变化导致不一致时，自动将不符合的模型移出分组（移除少数派，保留多数派）

### 改进
- **Toast 提示**：现在显示在所有弹框之上（z-index: 9999）
- **隐私**：遥测和错误上报功能现在**默认关闭**。如果用户希望帮助改进插件，可以在设置中手动开启 (`agCockpit.telemetryEnabled`)。

## [1.5.45]

### 重构
- **错误处理**：引入 `AntigravityError` 类统一管理预期内错误（超时、服务端消息、启动检查）

## [1.5.44]

### 修复
- **启动保护**：禁止在系统就绪前（端口为0时）发起 API 请求，修复误报的 "Connection Refused (443)" 错误

## [1.5.43]

### 修复
- **代理绕过**：强制 localhost 连接绕过 HTTP 代理，修复用户开启全局代理导致的连接超时问题

## [1.5.42]

### 改进
- **错误上报**：服务端返回的错误（如"未登录"）不再上报到 Sentry

## [1.5.41]

### 改进
- **网络超时**：HTTP 请求超时时间从 5 秒增加到 10 秒，兼容 WSL2 等慢环境

## [1.5.40]

### 改进
- **自动拆分分组**：配额刷新时，自动拆分配额不一致的分组

## [1.5.39]

### 改进
- **错误上报**：仅上报启动阶段的错误；成功获取配额后，后续同步失败不再上报
- **服务端错误展示**：后端错误消息现在以"Antigravity 错误:"前缀透传给用户，而非显示笼统的"服务器响应无效"

## [1.5.38]

### 改进
- **错误上报**：新增匿名用户/会话标识与编辑器元信息，便于区分不同用户环境
- **诊断上下文**：上报中包含运行时限制与插件配置快照，提升定位效率
- **标签**：增加编辑器、URI Scheme 与 UI 类型标签，便于快速筛选
- **端口扫描**：上报扫描方式与端口验证信息，便于定位连接问题

## [1.5.37]

### 新增
- **错误上报**：轻量级匿名错误上报，帮助改进插件
  - 自动捕获并上报错误，加速问题修复
  - 尊重 VS Code 的全局遥测设置
  - 可通过 `agCockpit.telemetryEnabled` 设置关闭
  - 收集内容：错误堆栈、操作系统类型与版本、VS Code 版本、插件版本

## [1.5.36]

### 改进
- **Windows 进程检测**：重构检测逻辑，全面采用 PowerShell 并强制启用 UTF-8 编码。彻底解决了中文系统下的乱码报错问题，并移除了对已弃用 `wmic` 工具的依赖。
- **连接稳定性**：将 PowerShell 连接超时时间从 8 秒增加至 15 秒，以更好地兼容冷启动耗时较长的环境。

## [1.5.35]

- 修复：修复了启动时的 'Unexpected end of JSON input' 错误，增加了自动恢复机制
- 优化：增强了 API 响应错误的诊断日志

## [1.5.34]

### 改进
- **剩余时间显示**：自适应时间格式，提升可读性
  - 小于 60 分钟：`Xm`（如 `45m`）
  - 小于 24 小时：`Xh Ym`（如 `4h 57m`）
  - 大于等于 24 小时：`Xd Yh Zm`（如 `1d 2h 30m`）

## [1.5.33]

### 修复
- **数据遮罩**：修复 `package.json` 中缺少 `agCockpit.dataMasked` 配置声明的问题，导致"隐藏数据"按钮点击无效。

## [1.5.32]

### 修复
- **翻译键错误**：修复状态栏控制器中使用了错误的翻译键 `status.error`，更正为 `statusBar.error`。
- **数据遮罩持久化**：计划详情中的"隐藏数据"状态现在可以在关闭和重新打开 Dashboard 后保持。
- **变量声明顺序**：将 `isProfileHidden` 和 `isDataMasked` 声明移到 dashboard.js 顶部，优化代码结构。

### 改进
- **用户体验**：将重置倒计时文案从"已恢复"改为"即将恢复"，更准确地反映配额恢复的延迟特性。
- **国际化**：更新了全部 14 种语言的 `dashboard.online` 翻译。

## [1.5.31]

### 修复
- **内存泄漏**：修复日志服务中事件监听器未正确清理的问题，现已在销毁时正确释放配置变化监听器。
- **重复通知**：移除 ReactorCore 中重复的配额通知逻辑，通知功能现统一由 TelemetryController 处理，避免用户收到重复通知。

### 改进
- **代码清理**：移除多个文件中未使用的变量和导入。

## [1.5.30]

### 新增
- **单元测试**: 集成 Jest 框架并添加进程检测逻辑测试。
- **自动化打包**: 切换构建流水线至 `esbuild`。

### 改进
- **构建体积**: VSIX 包体积从 216 KB 降至 162 KB。
- **清理**: 移除构建输出中的冗余历史文件。

## [1.5.23]

### 改进
- **进程检测**: 优化 Antigravity 进程检测逻辑，要求必须包含服务端口和 CSRF Token，移除不准确的路径匹配以消除误报。
- **体积优化**: 通过新增 `.vscodeignore` 排除源码、Source Map 和演示截图，插件包体积缩减约 67%。
- **工程化完善**: 修复所有 Lint 错误，更新 TS 配置以支持现代 ESM 导入语法。

### 修复
- **状态栏**: 修正状态栏悬浮预览中套餐名称的显示。

## [1.5.22]

### 修复
- **面板更新**：修复了自动刷新时若面板在后台，切换回来数据未更新的问题。
- **配额精度**：修复了仪表盘（列表视图）与状态栏配额百分比显示不一致的问题，现已统一为向下取整。

## [1.5.21]

### 改进
- **文档**：重写 README，整合功能列表

---

## [1.5.20]

### 新增
- **QuickPick 模式**：完整分组模式支持，与 Webview 分组功能一致
- **QuickPick 模式**：标题栏操作按钮（刷新、切换分组、日志、设置、Webview）
- **QuickPick 模式**：自动分组按钮（仅分组模式下显示）
- **QuickPick 模式**：每个模型/分组项的重命名和重置按钮
- **QuickPick 模式**：刷新冷却机制，防止频繁连续刷新

### 改进
- **QuickPick 模式**：操作从列表项移至标题栏按钮，界面更简洁
- **QuickPick 模式**：进度条和重置时间移至详情行，对齐更整齐
- **翻译**：为全部 13 种支持语言添加 QuickPick 专属翻译

### 修复
- **显示模式**：在 Webview 和 QuickPick 之间切换时分组状态正确保持

---

## [1.5.19]

### 改进
- **QuickPick 模式**：切换"固定到状态栏"时改为局部刷新，只更新被点击的项，不再重建整个列表
- **QuickPick 模式**：移除冗余的状态图标（对号/警告/错误），仅保留固定图标，界面更简洁

---

## [1.5.18]

### 改进
- **代码架构**：重构 `extension.ts` 为模块化控制器，提升可维护性和性能。
- **UI 对齐**：修复 Windows 平台下进度条对齐问题，改用跨平台兼容的方块字符。

## [1.5.17]

### 新增
- **列表视图模式**：新增表格样式的配额展示视图
  - 通过 设置 → 视图模式（卡片/列表）切换

---

## [1.5.16]

### 新增
- **多语言支持扩展**：国际化支持从 2 种语言扩展到 14 种语言
  - 🇺🇸 English (en) - 英语
  - 🇨🇳 简体中文 (zh-cn)
  - 🇯🇵 日本語 (ja) - 日语 - 新增
  - 🇪🇸 Español (es) - 西班牙语 - 新增
  - 🇩🇪 Deutsch (de) - 德语 - 新增
  - 🇫🇷 Français (fr) - 法语 - 新增
  - 🇧🇷 Português do Brasil (pt-br) - 巴西葡萄牙语 - 新增
  - 🇷🇺 Русский (ru) - 俄语 - 新增
  - 🇰🇷 한국어 (ko) - 韩语 - 新增
  - 🇮🇹 Italiano (it) - 意大利语 - 新增
  - 🇹🇼 繁體中文 (zh-tw) - 繁体中文 - 新增
  - 🇹🇷 Türkçe (tr) - 土耳其语 - 新增
  - 🇵🇱 Polski (pl) - 波兰语 - 新增
  - 🇨🇿 Čeština (cs) - 捷克语 - 新增

### 改进
- **模块化翻译**：重构国际化架构，使用独立翻译文件，便于维护
- **语言检测优化**：增强语言环境检测，支持语言变体的自动回退映射

---

## [1.5.15]

### 改进
- **模型能力展示**：新增模型能力悬浮提示，悬停模型名称即可查看详细能力。
- **智能分组兜底**：优化“自动分组”逻辑，增加兜底分组策略。

---

## [1.5.14]

### 改进
- **分组模式引导**：在分组模式顶部添加说明文案，引导用户使用自动分组和模式切换功能

## [1.5.13]

### 新增
- **首次启动自动分组**：当分组功能已启用但尚无分组映射时，首次启动自动计算并保存分组

---

## [1.5.12]

### 修复
- **状态颜色**：状态球颜色调整回更鲜艳的色调（使用终端/图表高亮色，替代较暗的图标色）

---

## [1.5.11]

### 新增
- **名称+数字模式**：新增状态栏格式 `Sonnet: 95%`（不带状态球）

### 变更
- **状态栏选择器**：从按钮组改为下拉框，界面更简洁
- **设置标题**：从"提醒设置"简化为"设置"
- **设置自动保存**：所有设置立即生效，无需手动保存
- **阈值自动调整**：超出范围的值自动调整为有效值

### 修复
- **设置弹框保持**：数据自动刷新时弹框不再关闭

---

## [1.5.1]

### 新增
- **重置名称按钮**：重命名弹框新增"重置"按钮，可快速恢复原始名称

### 修复
- **状态栏同步**：自定义模型名称现在会正确显示在状态栏中（非分组模式）

### 改进
- **主题适配**：使用 VS Code 主题变量适配颜色（Tooltip、语义色、标签等）

---

## [1.5.0]

### 新增
- **模型重命名**：在非分组模式下可以重命名单个模型（点击模型卡片上的 ✏️ 图标）
- **状态栏样式选择器**：在设置面板中提供 5 种状态栏显示模式
  - 仅图标（`🚀`）
  - 仅状态球（`🟢` | `🟡` | `🔴`）
  - 仅数字（`95%`）
  - 状态球+数字（`🟢 95%`）
  - 完整显示（`🟢 Sonnet: 95%`）- 默认

### 变更
- 设置面板新增状态栏样式选择器，支持实时预览
- 自定义模型名称跨会话持久化保存

---

## [1.4.24]

### 变更
- QuickPick 模式：使用 Emoji 图标，确保在所有主题下始终可见

---

## [1.4.23]

### 新增
- QuickPick 模式：添加「切换到 Webview 模式」按钮，方便切换显示模式

---

## [1.4.22]

### 新增
- QuickPick 兼容模式：使用 VSCode 原生 QuickPick API 替代 Webview
- 更好兼容 Webview 不受支持的环境
- 通过 `agCockpit.displayMode: "quickpick"` 配置启用
- 功能：查看所有模型配额、切换状态栏固定、刷新数据
- Webview 加载失败时自动引导用户切换到 QuickPick 模式

---

## [1.4.21]

### 变更
- 文档：拆分中英文 README 与更新日志，并加入语言切换链接
- 文档：以 Open VSX 徽章/链接作为主要分发渠道

---

## [1.4.20]

### 修复
- 修复启动时服务未就绪（500 错误）导致的 `Cannot read properties of undefined` 崩溃问题
- 添加服务器响应验证，提供更清晰的错误信息

### 新增
- 启动时自动重试机制：首次同步失败会自动重试最多 3 次

---

## [1.4.19]

### 安全
- 诊断日志中的敏感信息（csrf_token）脱敏处理，防止信息泄露

---

## [1.4.18]

### 新增
- 创建独立的 `CHANGELOG.md` 文件，记录所有历史版本更新

### 变更
- README 中的 Changelog 章节改为引用独立文件
- 移除冗余的 `activationEvents` 配置（VS Code 自动生成）

---

## [1.4.17]

### 新增
- 启动日志中显示插件版本号，方便问题排查

---

## [1.4.16]

### 修复
- 优化进程识别逻辑，精准匹配 Antigravity 进程
- 避免误识别 Windsurf 等其他编辑器进程
- 强制要求 `--app_data_dir antigravity` 参数或路径包含 `antigravity`

---

## [1.4.15]

### 修复
- 修复所有 ESLint 错误（23 个错误 → 0）
- 将 `require()` 改为 ES6 动态 `import()`
- 为 case 块添加花括号作用域
- 修复 TypeScript `any` 类型警告

### 改进
- 增强 Windows 进程检测容错性
- 添加 PowerShell/WMIC 双向自动切换机制
- 添加切换次数限制防止无限循环
- PowerShell 冷启动等待时间从 1秒 增加到 2秒
- 检测 PowerShell 执行策略和 WMI 服务问题
- 增强诊断信息，提供用户友好的故障排除提示

---

## [1.4.14]

### 修复
- 修复多进程场景下的进程检测问题
- 改进进程验证逻辑

---

## [1.4.13]

### 变更
- 分组重命名改用模态框输入
- 移除仪表盘中的"最后更新时间"显示

---

## [1.4.12]

### 修复
- 修复 PowerShell 冷启动超时问题
- 增加进程命令执行超时时间至 8 秒

---

## [1.4.11]

### 变更
- 版本号整理

---

## [1.4.1]

### 新增
- 添加阈值通知开关，支持用户控制是否弹窗提醒

### 修复
- 修复通知开关状态未正确传递到前端的问题
- 修复点击状态栏和刷新缓存时阈值颜色判断错误的问题

---

## [1.4.0]

### 新增
- 可配置的警告/危险阈值
- 快捷键支持（查看日志、打开仪表盘等）
- 反馈入口（GitHub Issues）
- 阈值通知功能

### 改进
- 优化配额判断逻辑
- 统一颜色显示标准

---

## [1.3.14]

### 新增
- 添加备用关键字搜索（通过 `csrf_token` 查找进程）

### 修复
- 修复 PowerShell 引号转义问题

---

## [1.3.12]

### 修复
- 修正仪表盘状态逻辑
- 完善国际化支持
- Tooltip 中使用完整模型名称

---

## [1.3.1]

### 新增
- 状态栏彩色指示器（🟢🟡🔴）
- 统一的三色状态逻辑

### 改进
- 精度修复
- 工具提示模型顺序与仪表盘一致

---

## [1.3.0]

### 新增
- Tooltip 对齐优化
- 统一阈值配置
- 自动重试机制

---

## [1.2.16]

### 新增
- 首次切换到分组模式时自动分组

---

## [1.2.15]

### 新增
- 手动自动分组功能
- 持久化分组映射

---

## [1.2.13]

### 修复
- 确保自动置顶在 UI 刷新前执行

---

## [1.2.12]

### 修复
- 使用基于模型 ID 的稳定 groupId

---

## [1.2.11]

### 修复
- 多项改进和错误修复

---

## [1.2.1]

### 修复
- 首次启用分组时自动置顶所有分组

---

## [1.2.0]

### 新增
- 配额分组功能
- 分组自定义名称
- 分组拖拽排序
- 分组状态栏显示

---

## [1.1.153]

### 新增
- 使用趋势图可见性切换

---

## [1.1.152]

### 新增
- 配额历史图表（7 天数据保留）

---

## [1.1.151]

### 改进
- 简化用户资料控制
- 数据掩码改用文本按钮
- 可见性切换移至头部

---

## [1.1.150]

### 新增
- 用户资料可见性切换
- 敏感数据掩码功能

---

## [1.1.149]

### 新增
- 隐私模式
- 用户资料可见性切换

---

## [1.1.148]

### 修复
- 移除 Prompt Credits 设置
- 配置变更时自动更新状态栏

---

## [1.1.147]

### 修复
- 连接失败时自动重新扫描

---

## [1.1.146]

### 修复
- 状态栏错误状态未清除的问题

---

## [1.1.144]

### 变更
- 将"User ID"重命名为"Internal Tier ID"

---

## [1.1.143]

### 新增
- 详细用户资料字段本地化

---

## [1.1.142]

### 改进
- 上下文窗口逻辑移至固定区域

---

## [1.1.14]

### 新增
- 完整的用户资料详情
- 状态持久化

---

## [1.1.13]

### 改进
- 优化 UI 交互
- 修复置顶切换功能

---

## [1.1.12]

### 改进
- 增强调试日志
- 优化刷新行为

---

## [1.1.11]

### 修复
- 使用向下取整百分比，避免误导性的 100%

---

## [1.0.0]

### 新增
- 首次发布 🎉
- 沉浸式仪表盘
- 精确定时刷新
- 交互式控制（拖拽排序、置顶模型）
- 智能状态栏
- 智能通知
- 中英文双语支持
- 跨平台支持（Windows / macOS / Linux）
